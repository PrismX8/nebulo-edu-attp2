<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <meta name="description" content="Nebulo Education Plus is a math-focused experience offering educational algebra practice tests to strengthen advanced math skills.">
  <meta name="keywords" content="math, algebra, advanced math practice test, educational exercises, study tools">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Nebulo Education Plus - Educational Algebra Practice Tests">
  <meta property="og:description" content="Step into a dedicated math site built around educational algebra practice tests designed to enhance advanced math skills.">
<title>Browser - Nebulo OS</title>
  <link rel="icon" type="image/x-icon" href="https://ibb.co/4g2Q0515" />
  <!-- Open Graph Meta -->
<meta property="og:url" content="https://neb.school.dovereducation.org">
  <meta property="og:image" content="/assets/img/embed.png">
<!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Base Scripts (Core Services) -->
  <script src="/baremux/index.js" defer></script>
  <script src="/epoxy/index.js" defer></script>
  <script src="/vu/uv.bundle.js" defer></script>
  <script src="/vu/uv.config.js" defer></script>
  <script src="/scram/mathjet.controller.js" defer></script>
  <script src="/lisp/lisp.codecs.js" defer></script>
  <script src="/lisp/lisp.config.js" defer></script>
  <style>
    /* Nebulo V5.3 Theme Variables */
    :root {
      --bg0: #070b14;
      --bg1: #0b1220;
      --card: rgba(16, 24, 40, 0.95);
      --card2: rgba(18, 28, 48, 0.98);
      --stroke: rgba(255, 255, 255, 0.12);
      --stroke2: rgba(125, 211, 192, 0.32);
      --text: #eaf0ff;
      --text-muted: rgba(234, 240, 255, 0.75);
      --text-secondary: rgba(234, 240, 255, 0.55);
      --accent: #7dd3c0;
      --accent2: #60a5fa;
      --danger: #ff5c7a;
      --success: #10b981;
      --warning: #f59e0b;
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 24px;
      --shadow: 0 20px 60px rgba(0, 0, 0, 0.65);
      --shadow-sm: 0 12px 32px rgba(0, 0, 0, 0.45);
      --shadow-lg: 0 30px 90px rgba(0, 0, 0, 0.75);
      --transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      --transition-slow: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    html, body {
      height: 100%;
      overflow: hidden;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg0) 0%, var(--bg1) 100%);
    }
    body {
      display: flex;
      flex-direction: column;
    }
    /* Top Navigation Bar */
    .navbar {
      height: 64px;
      background: var(--card);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--stroke);
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 12px;
      flex-shrink: 0;
      position: relative;
      z-index: 100;
    }
    body.hide-address-bar .address-bar-container {
      display: none;
    }
    /* Navigation Controls */
    .nav-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .nav-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--stroke);
      color: var(--text);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent);
      transform: translateY(-1px);
    }
    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      border-color: var(--stroke);
    }
    .nav-btn:disabled:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--stroke);
    }
    .nav-btn i {
      font-size: 16px;
    }
    /* Address Bar */
    .address-bar-container {
      flex: 1;
      position: relative;
    }
    .address-bar {
      width: 100%;
      height: 40px;
      background: rgba(12, 18, 34, 0.85);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      color: var(--text);
      padding: 0 48px 0 16px;
      font-size: 14px;
      font-weight: 500;
      outline: none;
      transition: var(--transition);
    }
    .address-bar:focus {
      border-color: var(--accent);
      background: rgba(12, 18, 34, 0.95);
      box-shadow: 0 0 0 3px rgba(125, 211, 192, 0.15);
    }
    .address-bar::placeholder {
      color: var(--text-secondary);
    }
    .search-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(125, 211, 192, 0.15);
      border: 1px solid rgba(125, 211, 192, 0.3);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .search-btn:hover {
      background: rgba(125, 211, 192, 0.25);
      transform: translateY(-50%) scale(1.05);
    }
    .search-btn i {
      font-size: 14px;
    }
    /* Action Buttons */
    .action-buttons {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .action-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--stroke);
      color: var(--text);
      cursor: pointer;
      transition: var(--transition);
    }
    .action-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-1px);
    }
    .action-btn.warning:hover {
      background: rgba(245, 158, 11, 0.2);
      border-color: var(--warning);
      color: var(--warning);
    }
    /* Status Indicators */
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      margin-right: 6px;
      display: inline-block;
    }
    .status-loading {
      animation: pulse 1.5s ease-in-out infinite;
      background: var(--warning);
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    /* Frame Container */
    .frame-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      background: rgba(6, 10, 18, 0.3);
    }
    #frame {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
    }
    /* Loading Overlay */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(8, 12, 22, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .loading-overlay.active {
      opacity: 1;
      pointer-events: all;
    }
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-text {
      font-size: 14px;
      color: var(--text-muted);
      font-weight: 500;
      text-align: center;
    }
    /* URL Suggestions */
    .suggestions-container {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: var(--card2);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      backdrop-filter: blur(20px) saturate(180%);
      box-shadow: var(--shadow);
      overflow: hidden;
      z-index: 1000;
      display: none;
    }
    .suggestion-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    .suggestion-item:last-child {
      border-bottom: none;
    }
    .suggestion-icon {
      width: 20px;
      height: 20px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .suggestion-text {
      flex: 1;
      font-size: 14px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* Tooltips */
    .tooltip {
      position: absolute;
      background: var(--card2);
      border: 1px solid var(--stroke);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      font-size: 12px;
      color: var(--text);
      white-space: nowrap;
      z-index: 10000;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-sm);
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none;
    }
    .tooltip.show {
      opacity: 1;
      transform: translateY(0);
    }
    /* Browser Info Bar */
    .info-bar {
      height: 28px;
      background: rgba(0, 0, 0, 0.3);
      border-top: 1px solid var(--stroke);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      font-size: 11px;
      color: var(--text-secondary);
      flex-shrink: 0;
    }
    .info-left, .info-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    /* Responsive Design */
    @media (max-width: 768px) {
      .navbar {
        padding: 0 12px;
        gap: 8px;
      }
      .nav-controls {
        gap: 4px;
      }
      .nav-btn, .action-btn {
        width: 32px;
        height: 32px;
      }
      .address-bar {
        padding: 0 40px 0 12px;
        font-size: 13px;
      }
      .action-buttons {
        gap: 4px;
      }
      .info-bar {
        font-size: 10px;
        padding: 0 12px;
      }
    }
    @media (max-width: 480px) {
      .navbar {
        height: 56px;
      }
      .nav-btn, .action-btn {
        width: 28px;
        height: 28px;
      }
      .nav-btn i, .action-btn i {
        font-size: 14px;
      }
      .address-bar {
        height: 36px;
        font-size: 12px;
      }
    }
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    /* Animation for page transitions */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .frame-container {
      animation: fadeIn 0.3s ease;
    }
    /* Focus ring accessibility */
    .nav-btn:focus-visible,
    .action-btn:focus-visible,
    .address-bar:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <!-- Top Navigation Bar -->
  <nav class="navbar">
    <!-- Navigation Controls -->
    <div class="nav-controls">
      <button class="nav-btn" id="backBtn" title="Go Back" disabled>
        <i class="fas fa-arrow-left"></i>
      </button>
      <button class="nav-btn" id="forwardBtn" title="Go Forward" disabled>
        <i class="fas fa-arrow-right"></i>
      </button>
      <button class="nav-btn" id="reloadBtn" title="Reload">
        <i class="fas fa-rotate"></i>
      </button>
    </div>
    <!-- Address Bar -->
    <div class="address-bar-container">
      <input type="text" class="address-bar" id="addressBar" 
             placeholder="Search or enter a URLâ€¦" 
             autocomplete="off" 
             spellcheck="false" />
      <button class="search-btn" id="searchBtn" title="Go">
        <i class="fas fa-arrow-right"></i>
      </button>
      <!-- URL Suggestions -->
      <div class="suggestions-container" id="suggestions"></div>
    </div>
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="action-btn" id="homeBtn" title="Home">
        <i class="fas fa-home"></i>
      </button>
      <button class="action-btn warning" id="devtoolsBtn" title="Developer Tools">
        <i class="fas fa-code"></i>
      </button>
    </div>
  </nav>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading page...</div>
  </div>
  <!-- Frame Container -->
  <div class="frame-container" id="frameContainer">
    <iframe src="" frameborder="0" id="frame"></iframe>
  </div>
  <!-- Info Bar -->
  <div class="info-bar">
    <div class="info-left">
      <span id="pageTitle">Nebulo Browser</span>
    </div>
    <div class="info-right">
      <span id="pageStatus">Ready</span>
      <span id="connectionSpeed">Online</span>
    </div>
  </div>
  <!-- Tooltip -->
  <div class="tooltip" id="tooltip"></div>
  <!-- Scripts -->
  <script src="assets/js/themes.js" defer></script>
  <script>
    /* ============================================
       NEBULO BROWSER V5.3 - Enhanced with OS Proxy Logic
       ============================================ */
    const SEARCH_HISTORY_KEY = "nebuloSearchHistory";
    const MAX_SEARCH_HISTORY = 6;
    const VERSION = "V5.3";
    // Common apps for suggestions (same as OS)
    const commonApps = [
      { id:'browser', name:'Browser', url:'/search', icon:'/assets/imgs/browser.png' },
      { id:'games', name:'Games', url:'/games', icon:'/assets/imgs/games.png' },
      { id:'music', name:'Music', url:'https://vapor.onl/page/music/index.html', icon:'/assets/imgs/music.png', proxied: true },
      { id:'movies', name:'Movies', url:'https://www.cineby.gd', icon:'/assets/imgs/movies.png', proxied: true },
      { id:'roblox', name:'Roblox', url:'https://astra.pxi-fusion.com/embed/roblox?web-socket-enabled=false', icon:'/roblox.png', proxied: true },
      { id:'clash-royale', name:'Clash Royale', url:'https://astra.pxi-fusion.com/embed/clash-royale?web-socket-enabled=false', icon:'/clash-royale.png', proxied: true },
      { id:'minecraft', name:'Minecraft', url:'https://eaglercraft1-8.github.io/', icon:'/assets/imgs/Minecraft_Classic.png', proxied: true },
      { id:'chat', name:'Global Chat', url:'/chatonly.html', icon:'fa-comments' },
      { id:'settings', name:'Settings', url:'/settings', icon:'fa-cog' }
    ];
    // Search engines
    const SEARCH_ENGINE_DEFAULT = "brave";
    const PROXY_DEFAULT = "uv";
    // Initialize browser functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize tooltips
      const buttons = document.querySelectorAll('.nav-btn, .action-btn, .search-btn');
      const tooltip = document.getElementById('tooltip');
      buttons.forEach(button => {
        button.addEventListener('mouseenter', (e) => {
          const title = e.currentTarget.getAttribute('title');
          if (title) {
            const rect = e.currentTarget.getBoundingClientRect();
            tooltip.textContent = title;
            tooltip.style.left = rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + 'px';
            tooltip.style.top = rect.top - 40 + 'px';
            tooltip.classList.add('show');
          }
        });
        button.addEventListener('mouseleave', () => {
          tooltip.classList.remove('show');
        });
      });
      // Navigation button states
      const backBtn = document.getElementById('backBtn');
      const forwardBtn = document.getElementById('forwardBtn');
      const reloadBtn = document.getElementById('reloadBtn');
      const homeBtn = document.getElementById('homeBtn');
      const devtoolsBtn = document.getElementById('devtoolsBtn');
      const searchBtn = document.getElementById('searchBtn');
      const addressBar = document.getElementById('addressBar');
      const frame = document.getElementById('frame');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const suggestions = document.getElementById('suggestions');
      // Navigation history
      let history = [];
      let historyIndex = -1;
      /* ============================================
         PROXY & SEARCH FUNCTIONS (From OS Script)
         ============================================ */
      function resolveSearchUrl(query) {
        // If it's a full URL, return it
        if (query.startsWith('http://') || query.startsWith('https://')) {
          return query;
        }
        // If it's a relative URL (starts with /), return it as is
        if (query.startsWith('/')) {
          return query;
        }
        // If it looks like a domain (has a dot and no spaces), add https://
        if (query.includes('.') && !query.includes(' ')) {
          return 'https://' + query;
        }
        // Otherwise, treat as a search query
        const engine = (localStorage.getItem('searchEngine') || SEARCH_ENGINE_DEFAULT).toLowerCase();
        switch (engine) {
          case 'brave':
            return `https://search.brave.com/search?q=${encodeURIComponent(query)}`;
          case 'google':
            return `https://www.google.com/search?q=${encodeURIComponent(query)}`;
          case 'duckduckgo':
            return `https://duckduckgo.com/?t=h_&q=${encodeURIComponent(query)}`;
          case 'bing':
            return `https://www.bing.com/search?q=${encodeURIComponent(query)}`;
          case 'yahoo':
            return `https://search.yahoo.com/search?p=${encodeURIComponent(query)}`;
          case 'ecosia':
            return `https://www.ecosia.org/search?q=${encodeURIComponent(query)}`;
          case 'irs':
            return `https://www.irs.gov/site-index-search?search=${encodeURIComponent(query)}`;
          default:
            return `https://search.brave.com/search?q=${encodeURIComponent(query)}`;
        }
      }
      // Proxy encoding function (same as OS)
      async function encodeWithProxy(url, proxyHint = null) {
        try {
          if (window.proxyEncoder) {
            return await window.proxyEncoder.encode(url, proxyHint);
          } else if (typeof __uv$config !== 'undefined') {
            return __uv$config.prefix + __uv$config.encodeUrl(url);
          } else if (typeof window.encodeProxiedUrl === "function") {
            return window.encodeProxiedUrl(url);
          }
        } catch(e) {
          console.error('Proxy encoding failed:', e);
        }
        return url;
      }
      // Original encodeUrlWithProxy (kept for compatibility)
      async function encodeUrlWithProxy(url, overrideProxy) {
        const proxy = overrideProxy || localStorage.getItem('proxy') || PROXY_DEFAULT;
        switch (proxy) {
          case 'sj':
            if (typeof scramjet !== 'undefined' && typeof scramjet.encodeUrl === 'function') {
              return scramjet.encodeUrl(url);
            }
            break;
          case 'ec':
            if (typeof __eclipse$config !== 'undefined' && __eclipse$config.codec) {
              return __eclipse$config.prefix + __eclipse$config.codec.encode(url);
            }
            break;
          case 'rh':
            if (typeof RammerheadEncode === 'function') {
              return await RammerheadEncode(url);
            }
            break;
          case 'uv':
          default:
            if (typeof __uv$config !== 'undefined') {
              return __uv$config.prefix + __uv$config.encodeUrl(url);
            }
            break;
        }
        return url;
      }
      // Set up proxy encoder (same as OS)
      window.proxyEncoder = {
        encode: encodeUrlWithProxy
      };
      /* ============================================
         SEARCH HISTORY FUNCTIONS (From OS Script)
         ============================================ */
      function loadSearchHistory() {
        try {
          const raw = localStorage.getItem(SEARCH_HISTORY_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (err) {
          console.warn('Failed to parse search history', err);
          return [];
        }
      }
      function saveSearchHistory(history) {
        try {
          localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(history));
        } catch {}
      }
      function addSearchHistory(term) {
        if (!term) return;
        const normalized = term.trim();
        if (!normalized) return;
        let history = loadSearchHistory();
        history = history.filter(entry => entry.toLowerCase() !== normalized.toLowerCase());
        history.unshift(normalized);
        if (history.length > MAX_SEARCH_HISTORY) {
          history = history.slice(0, MAX_SEARCH_HISTORY);
        }
        saveSearchHistory(history);
      }
      /* ============================================
         BROWSER NAVIGATION FUNCTIONS
         ============================================ */
      // Update navigation buttons
      function updateNavButtons() {
        backBtn.disabled = historyIndex <= 0;
        forwardBtn.disabled = historyIndex >= history.length - 1;
        backBtn.style.opacity = backBtn.disabled ? '0.5' : '1';
        forwardBtn.style.opacity = forwardBtn.disabled ? '0.5' : '1';
      }
      // Navigate to URL with proxy (updated with OS logic)
      async function toggleAddressBarVisibility(resolvedUrl) {
        const hide = resolvedUrl === '/search' || resolvedUrl.startsWith('/search');
        document.body.classList.toggle('hide-address-bar', hide);
      }
      async function navigateTo(rawUrl) {
        if (!rawUrl) return;
        try {
          loadingOverlay.classList.add('active');
          const resolvedUrl = resolveSearchUrl(rawUrl);
          if (!resolvedUrl) {
            loadingOverlay.classList.remove('active');
            return;
          }
          // Check if it's an app from our list
          const app = commonApps.find(a => a.id === rawUrl || a.name.toLowerCase() === rawUrl.toLowerCase());
          let finalUrl = resolvedUrl;
          // If it's an external app that needs proxying
          if (app && app.proxied) {
            finalUrl = await encodeWithProxy(app.url);
          } else if (resolvedUrl.startsWith('http://') || resolvedUrl.startsWith('https://')) {
            finalUrl = await encodeWithProxy(resolvedUrl);
          } else {
            finalUrl = resolvedUrl;
          }
          frame.src = finalUrl;
          await toggleAddressBarVisibility(resolvedUrl);
          if (historyIndex < history.length - 1) {
            history = history.slice(0, historyIndex + 1);
          }
          history.push(rawUrl);
          historyIndex++;
          updateNavButtons();
          updatePageInfo(rawUrl);
          addSearchHistory(rawUrl);
        } catch (error) {
          console.error('Navigation error:', error);
          loadingOverlay.classList.remove('active');
          document.getElementById('pageStatus').textContent = 'Navigation error';
        }
      }
      // Update page info
      function updatePageInfo(url) {
        try {
          // Try to extract a clean title
          if (url.startsWith('/')) {
            document.getElementById('pageTitle').textContent = url.substring(1) || 'Home';
          } else {
            const urlObj = new URL(url);
            document.getElementById('pageTitle').textContent = urlObj.hostname.replace('www.', '');
          }
        } catch (e) {
          document.getElementById('pageTitle').textContent = url.substring(0, 30) + (url.length > 30 ? '...' : '');
        }
        document.getElementById('pageStatus').textContent = 'Loading...';
      }
      /* ============================================
         SUGGESTIONS SYSTEM (Same as OS)
         ============================================ */
      function showSuggestions(query) {
        const trimmed = (query || '').trim();
        const q = trimmed.toLowerCase();
        let html = '';
        // Filter apps by query
        const appMatches = commonApps.filter(app => 
          app.name.toLowerCase().includes(q) || 
          app.id.toLowerCase().includes(q)
        ).slice(0, 4);
        if (appMatches.length > 0) {
          html += appMatches.map(app => `
            <div class="suggestion-item" data-type="app" data-id="${app.id}">
              <div class="suggestion-icon">
                ${app.icon.startsWith('fa-') ? `<i class="fas ${app.icon}"></i>` : `<img src="${app.icon}" style="width:16px;height:16px;">`}
              </div>
              <div class="suggestion-text">
                <strong>${escapeHtml(app.name)}</strong>
                <div style="font-size: 12px; color: var(--text-secondary);">${escapeHtml(app.url)}</div>
              </div>
            </div>
          `).join('');
        }
        // Load search history
        const history = loadSearchHistory();
        const historyMatches = q ? 
          history.filter(entry => entry.toLowerCase().includes(q)).slice(0, 4) :
          history.slice(0, 4);
        if (historyMatches.length > 0) {
          html += `<div class="suggestion-item" style="background: rgba(255,255,255,0.03); font-size: 11px; color: var(--text-secondary);">
                    <i class="fas fa-clock"></i> Recent Searches
                  </div>`;
          html += historyMatches.map(entry => `
            <div class="suggestion-item" data-type="history" data-term="${escapeAttr(entry)}">
              <div class="suggestion-icon">
                <i class="far fa-clock"></i>
              </div>
              <div class="suggestion-text">${escapeHtml(entry)}</div>
            </div>
          `).join('');
        }
        if (trimmed) {
          html += `
            <div class="suggestion-item" data-type="search" data-term="${escapeAttr(trimmed)}">
              <div class="suggestion-icon">
                <i class="fas fa-search"></i>
              </div>
              <div class="suggestion-text">
                <strong>Search for "${escapeHtml(trimmed)}"</strong>
                <div style="font-size: 12px; color: var(--text-secondary);">Using ${localStorage.getItem('searchEngine') || SEARCH_ENGINE_DEFAULT}</div>
              </div>
            </div>
          `;
        }
        suggestions.innerHTML = html;
        suggestions.style.display = 'block';
        // Add event listeners to suggestions
        suggestions.querySelectorAll('.suggestion-item[data-type]').forEach(item => {
          item.addEventListener('click', async () => {
            const type = item.getAttribute('data-type');
            const value = item.getAttribute('data-id') || item.getAttribute('data-term');
            switch (type) {
              case 'app':
                const app = commonApps.find(a => a.id === value);
                if (app) {
                  addressBar.value = app.name;
                  await navigateTo(app.url);
                }
                break;
              case 'history':
              case 'search':
                addressBar.value = value;
                await navigateTo(value);
                break;
            }
            suggestions.style.display = 'none';
          });
        });
      }
      function hideSuggestions() {
        suggestions.style.display = 'none';
      }
      /* ============================================
         EVENT HANDLERS
         ============================================ */
      // Frame event handlers
      frame.addEventListener('load', () => {
        loadingOverlay.classList.remove('active');
        document.getElementById('pageStatus').textContent = 'Ready';
        try {
          // Update address bar with the actual URL
          const frameUrl = frame.src;
          if (frameUrl.includes('/service/')) {
            // Try to decode proxy URL
            const encodedUrl = frameUrl.split('/service/')[1];
            if (encodedUrl) {
              try {
                const decodedUrl = decodeURIComponent(encodedUrl);
                addressBar.value = decodedUrl;
              } catch (e) {
                addressBar.value = frameUrl;
              }
            }
          } else if (frameUrl && frameUrl !== 'about:blank') {
            addressBar.value = frameUrl;
          }
        } catch (e) {
          console.warn('Could not update address bar:', e);
        }
      });
      frame.addEventListener('error', () => {
        loadingOverlay.classList.remove('active');
        document.getElementById('pageStatus').textContent = 'Error loading page';
      });
      // Navigation button handlers
      backBtn.addEventListener('click', () => {
        if (historyIndex > 0) {
          historyIndex--;
          navigateTo(history[historyIndex]);
        }
      });
      forwardBtn.addEventListener('click', () => {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          navigateTo(history[historyIndex]);
        }
      });
      reloadBtn.addEventListener('click', () => {
        if (frame.src) {
          frame.src = frame.src;
          loadingOverlay.classList.add('active');
          document.getElementById('pageStatus').textContent = 'Reloading...';
        }
      });
      homeBtn.addEventListener('click', () => {
        navigateTo('/search');
      });
      searchBtn.addEventListener('click', async () => {
        const url = addressBar.value.trim();
        if (url) {
          await navigateTo(url);
        }
      });
      addressBar.addEventListener('keypress', async (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          const url = addressBar.value.trim();
          if (url) {
            await navigateTo(url);
          }
        }
      });
      addressBar.addEventListener('input', () => {
        const query = addressBar.value.trim();
        if (query.length > 0) {
          showSuggestions(query);
        } else {
          hideSuggestions();
        }
      });
      addressBar.addEventListener('focus', () => {
        const query = addressBar.value.trim();
        if (query.length > 0) {
          showSuggestions(query);
        }
      });
      // Developer tools button
      devtoolsBtn.addEventListener('click', () => {
        try {
          if (frame.contentWindow && frame.contentWindow.eruda) {
            frame.contentWindow.eruda.init();
            frame.contentWindow.eruda.show();
          } else {
            const script = frame.contentWindow.document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/eruda';
            script.onload = () => {
              frame.contentWindow.eruda.init();
              frame.contentWindow.eruda.show();
            };
            frame.contentWindow.document.head.appendChild(script);
          }
        } catch (e) {
          console.warn('Cannot access iframe for devtools:', e);
          alert('Cannot open developer tools due to cross-origin restrictions');
        }
      });
      // Click outside to close suggestions
      document.addEventListener('click', (e) => {
        if (!addressBar.contains(e.target) && !suggestions.contains(e.target)) {
          hideSuggestions();
        }
      });
      /* ============================================
         UTILITY FUNCTIONS (From OS Script)
         ============================================ */
      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, c => ({
          "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
        }[c]));
      }
      function escapeAttr(s) {
        return escapeHtml(s).replace(/`/g, '&#096;');
      }
      /* ============================================
         INITIALIZATION
         ============================================ */
      // Initialize with empty state
      updateNavButtons();
      // Set initial status
      document.getElementById('pageStatus').textContent = 'Ready';
      document.getElementById('connectionSpeed').textContent = navigator.onLine ? 'Online' : 'Offline';
      // Monitor online/offline status
      window.addEventListener('online', () => {
        document.getElementById('connectionSpeed').textContent = 'Online';
      });
      window.addEventListener('offline', () => {
        document.getElementById('connectionSpeed').textContent = 'Offline';
      });
      // Focus address bar on load
      setTimeout(() => {
        addressBar.focus();
        // Load initial page
        navigateTo('/search');
      }, 100);
      // Quick function for global access (same as OS)
      window.quick = async function(url) {
        let encodedUrl = url;
        try {
          if (typeof __uv$config !== 'undefined') {
            encodedUrl = __uv$config.prefix + __uv$config.encodeUrl(url);
          }
        } catch(e) {
          console.error('Proxy encoding failed:', e);
        }
        localStorage.setItem("url", encodedUrl);
        sessionStorage.setItem("Url", encodedUrl);
        await navigateTo(url);
      };
    });
  </script>
</body>
</html>
